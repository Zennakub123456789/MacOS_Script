local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local Workspace = game:GetService("Workspace")

local LocalPlayer = Players.LocalPlayer
local Camera = Workspace.CurrentCamera


local AimSettings = {
    Enabled = false,
    FOV = 90,
    TargetPart = "Head",
    TeamCheck = false,
    AliveCheck = true,
    WallCheck = false,
    ShowFOV = true,
    Smoothness = 0.05
}

local ESPSettings = {
    Box = false,
    Line = false,
    Name = false,
    Health = false,
    Skeleton = false,
    Count = false,
    TeamCheck = false,
    AliveCheck = true,
    WallCheck = false,
    Color = Color3.fromRGB(255, 255, 255)
}

local CurrentTarget = nil


local R15_CONNECTIONS = {
    {"Head", "UpperTorso"}, {"UpperTorso", "LowerTorso"}, {"LowerTorso", "LeftUpperLeg"},
    {"LeftUpperLeg", "LeftLowerLeg"}, {"LowerTorso", "RightUpperLeg"}, {"RightUpperLeg", "RightLowerLeg"},
    {"UpperTorso", "LeftUpperArm"}, {"LeftUpperArm", "LeftLowerArm"}, {"LeftLowerArm", "LeftHand"},
    {"UpperTorso", "RightUpperArm"}, {"RightUpperArm", "RightLowerArm"}, {"RightLowerArm", "RightHand"}
}

local R6_CONNECTIONS = {
    {"Head", "Torso"}, {"Torso", "Left Arm"}, {"Torso", "Right Arm"},
    {"Torso", "Left Leg"}, {"Torso", "Right Leg"}
}


local ESP_Cache = {}
local FOVCircle = Drawing.new("Circle")
FOVCircle.Visible = false
FOVCircle.Transparency = 1
FOVCircle.Color = Color3.fromRGB(50, 215, 75)
FOVCircle.Thickness = 1.5
FOVCircle.NumSides = 60
FOVCircle.Filled = false
FOVCircle.Radius = AimSettings.FOV

local EnemyCounter = Drawing.new("Text")
EnemyCounter.Visible = false
EnemyCounter.Color = Color3.fromRGB(255, 50, 50)
EnemyCounter.Size = 18
EnemyCounter.Center = true
EnemyCounter.Outline = true


local CFG = {
    MainSize = UDim2.new(0, 500, 0, 300),
    MainColor = Color3.fromRGB(5, 5, 5),
    CardColor = Color3.fromRGB(11, 11, 11),
    BorderColor = Color3.fromRGB(30, 30, 30),
    Accent = Color3.fromRGB(50, 215, 75),
    TextMain = Color3.fromRGB(240, 240, 240),
    TextSub = Color3.fromRGB(130, 130, 130),
    HoverColor = Color3.fromRGB(60, 60, 60),
    Font = Enum.Font.GothamMedium,
    FontBold = Enum.Font.GothamBold,
}

local Library = { Flags = {}, Pages = {} }


local function CreateDrawing(type, props)
    local d = Drawing.new(type)
    for k, v in pairs(props or {}) do d[k] = v end
    return d
end

local function IsVisible(target, part)
    local Origin = Camera.CFrame.Position
    local Direction = (part.Position - Origin).Unit * (part.Position - Origin).Magnitude
    local RayParams = RaycastParams.new()
    RayParams.FilterDescendantsInstances = {LocalPlayer.Character, target}
    RayParams.FilterType = Enum.RaycastFilterType.Exclude
    RayParams.IgnoreWater = true
    local Result = Workspace:Raycast(Origin, Direction, RayParams)
    return Result == nil
end


local function AddESP(player)
    if ESP_Cache[player] then return end
    
    local SkelLines = {}
    for i = 1, 16 do
        SkelLines[i] = CreateDrawing("Line", {Thickness = 1, Color = Color3.new(1,1,1), Visible = false})
    end

    ESP_Cache[player] = {
        Box = CreateDrawing("Square", {Thickness = 1.5, Filled = false, Color = ESPSettings.Color}),
        Line = CreateDrawing("Line", {Thickness = 1.5, Color = ESPSettings.Color}),
        Name = CreateDrawing("Text", {Size = 13, Center = true, Outline = true, Color = Color3.new(1,1,1)}),
        HealthOutline = CreateDrawing("Square", {Thickness = 1, Filled = true, Color = Color3.new(0,0,0)}),
        HealthBar = CreateDrawing("Square", {Thickness = 1, Filled = true}),
        Skeleton = SkelLines
    }
end

local function RemoveESP(player)
    if ESP_Cache[player] then
        for k, d in pairs(ESP_Cache[player]) do
            if k == "Skeleton" then
                for _, line in pairs(d) do line:Remove() end
            else
                d:Remove()
            end
        end
        ESP_Cache[player] = nil
    end
end
Players.PlayerRemoving:Connect(RemoveESP)

local function HideESP(player)
    local Cache = ESP_Cache[player]
    if Cache then
        if Cache.Box then Cache.Box.Visible = false end
        if Cache.Line then Cache.Line.Visible = false end
        if Cache.Name then Cache.Name.Visible = false end
        if Cache.HealthOutline then Cache.HealthOutline.Visible = false end
        if Cache.HealthBar then Cache.HealthBar.Visible = false end
        if Cache.Skeleton then 
            for _, line in pairs(Cache.Skeleton) do line.Visible = false end 
        end
    end
end


local function GetTarget()
    local ClosestPlayer = nil
    local ShortestValue = math.huge
    local Center = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    local MyChar = LocalPlayer.Character
    local MyRoot = MyChar and MyChar:FindFirstChild("HumanoidRootPart")

    for _, Player in pairs(Players:GetPlayers()) do
        if Player ~= LocalPlayer then
            local Character = Player.Character
            local Humanoid = Character and Character:FindFirstChild("Humanoid")
            if Character and Humanoid and Character:FindFirstChild(AimSettings.TargetPart) and MyRoot then
                if AimSettings.AliveCheck and Humanoid.Health <= 0 then continue end
                if AimSettings.TeamCheck and Player.Team == LocalPlayer.Team then continue end

                local TargetPart = Character[AimSettings.TargetPart]
                local ScreenPoint, OnScreen = Camera:WorldToViewportPoint(TargetPart.Position)
                
                if AimSettings.WallCheck and not IsVisible(Character, TargetPart) then continue end

                if OnScreen then
                    if AimSettings.ShowFOV then
                        local TargetPos = Vector2.new(ScreenPoint.X, ScreenPoint.Y)
                        local DistToCenter = (Center - TargetPos).Magnitude
                        if DistToCenter <= AimSettings.FOV and DistToCenter < ShortestValue then
                            ShortestValue = DistToCenter
                            ClosestPlayer = Character
                        end
                    else
                        local DistToPlayer = (MyRoot.Position - TargetPart.Position).Magnitude
                        if DistToPlayer < ShortestValue then
                            ShortestValue = DistToPlayer
                            ClosestPlayer = Character
                        end
                    end
                end
            end
        end
    end
    return ClosestPlayer
end


RunService.RenderStepped:Connect(function()
    
    local Center = Vector2.new(Camera.ViewportSize.X / 2, Camera.ViewportSize.Y / 2)
    FOVCircle.Position = Center
    FOVCircle.Radius = AimSettings.FOV
    FOVCircle.Visible = AimSettings.ShowFOV and AimSettings.Enabled

    
    if AimSettings.Enabled then
        CurrentTarget = GetTarget()
        if CurrentTarget then
            local TargetPart = CurrentTarget[AimSettings.TargetPart]
            if TargetPart then
                local SmoothFactor = AimSettings.Smoothness
                TweenService:Create(Camera, TweenInfo.new(SmoothFactor, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {
                    CFrame = CFrame.new(Camera.CFrame.Position, TargetPart.Position)
                }):Play()
            end
        end
    end

    
    local VisibleCount = 0
    for _, Player in pairs(Players:GetPlayers()) do
        if Player ~= LocalPlayer then
            local Character = Player.Character
            local Humanoid = Character and Character:FindFirstChild("Humanoid")
            local Root = Character and Character:FindFirstChild("HumanoidRootPart")
            local Head = Character and Character:FindFirstChild("Head")

            if Character and Humanoid and Root and Head then
                
                local IsAlive = Humanoid.Health > 0
                local IsEnemy = (Player.Team ~= LocalPlayer.Team)
                
                local PassAlive = not ESPSettings.AliveCheck or IsAlive
                local PassTeam = not ESPSettings.TeamCheck or IsEnemy
                local PassWall = true

                if PassAlive and PassTeam then
                    if not ESP_Cache[Player] then AddESP(Player) end
                    
                    local Cache = ESP_Cache[Player]
                    if Cache then 
                        local Vector, OnScreen = Camera:WorldToViewportPoint(Root.Position)
                        
                        if ESPSettings.WallCheck then
                            if not IsVisible(Character, Root) then PassWall = false end
                        end

                        if OnScreen and PassWall then
                            VisibleCount = VisibleCount + 1
                            local Size = Vector3.new(2, 3, 0) * (Camera.ViewportSize.Y / Vector.Z) * 2
                            local Pos = Vector3.new(Vector.X - Size.X/2, Vector.Y - Size.Y/2, 0)

                            
                            if Cache.Box then
                                Cache.Box.Visible = ESPSettings.Box
                                Cache.Box.Size = Vector2.new(Size.X, Size.Y)
                                Cache.Box.Position = Vector2.new(Pos.X, Pos.Y)
                            end

                            
                            if Cache.Line then
                                if ESPSettings.Line then
                                    local HeadVec, HeadOn = Camera:WorldToViewportPoint(Head.Position)
                                    if HeadOn then
                                        Cache.Line.Visible = true
                                        Cache.Line.From = Vector2.new(Camera.ViewportSize.X / 2, 0)
                                        Cache.Line.To = Vector2.new(HeadVec.X, HeadVec.Y)
                                    else Cache.Line.Visible = false end
                                else Cache.Line.Visible = false end
                            end

                            
                            if Cache.Name then
                                Cache.Name.Visible = ESPSettings.Name
                                Cache.Name.Text = Player.Name
                                Cache.Name.Position = Vector2.new(Vector.X, Pos.Y - 15)
                            end

                            
                            if Cache.HealthBar then
                                if ESPSettings.Health then
                                    local hp = Humanoid.Health
                                    local maxHp = Humanoid.MaxHealth
                                    if maxHp <= 0 then maxHp = 100 end 
                                    local HealthPerc = math.clamp(hp / maxHp, 0, 1)

                                    local BarWidth = 2
                                    local BarHeight = Size.Y * HealthPerc
                                    local BarX = Pos.X - 5
                                    local BarY = Pos.Y + (Size.Y - BarHeight)
                                    
                                    Cache.HealthOutline.Visible = true
                                    Cache.HealthOutline.Size = Vector2.new(BarWidth + 2, Size.Y + 2)
                                    Cache.HealthOutline.Position = Vector2.new(BarX - 1, Pos.Y - 1)
                                    
                                    Cache.HealthBar.Visible = true
                                    Cache.HealthBar.Size = Vector2.new(BarWidth, BarHeight)
                                    Cache.HealthBar.Position = Vector2.new(BarX, BarY)
                                    
                                    Cache.HealthBar.Color = Color3.fromHSV(HealthPerc * 0.33, 1, 1) 
                                else
                                    Cache.HealthOutline.Visible = false
                                    Cache.HealthBar.Visible = false
                                end
                            end

                            
                            if ESPSettings.Skeleton and Cache.Skeleton then
                                local RigType = Humanoid.RigType
                                local Connections = {}
                                
                                if RigType == Enum.HumanoidRigType.R15 then
                                    Connections = R15_CONNECTIONS
                                elseif RigType == Enum.HumanoidRigType.R6 then
                                    Connections = R6_CONNECTIONS
                                end
                                
                                for i, conn in ipairs(Connections) do
                                    local partA = Character:FindFirstChild(conn[1])
                                    local partB = Character:FindFirstChild(conn[2])
                                    local line = Cache.Skeleton[i]
                                    
                                    if partA and partB and line then
                                        local posA, visA = Camera:WorldToViewportPoint(partA.Position)
                                        local posB, visB = Camera:WorldToViewportPoint(partB.Position)
                                        
                                        if visA and visB then
                                            line.Visible = true
                                            line.From = Vector2.new(posA.X, posA.Y)
                                            line.To = Vector2.new(posB.X, posB.Y)
                                        else
                                            line.Visible = false
                                        end
                                    elseif line then
                                        line.Visible = false
                                    end
                                end
                                for i = #Connections + 1, #Cache.Skeleton do
                                    Cache.Skeleton[i].Visible = false
                                end
                            elseif Cache.Skeleton then
                                for _, line in pairs(Cache.Skeleton) do line.Visible = false end
                            end

                        else
                            HideESP(Player)
                        end
                    end
                else
                    HideESP(Player)
                end
            else
                if ESP_Cache[Player] then RemoveESP(Player) end
            end
        end
    end

    EnemyCounter.Visible = ESPSettings.Count
    EnemyCounter.Text = "Enemies: " .. tostring(VisibleCount)
    EnemyCounter.Position = Vector2.new(Camera.ViewportSize.X / 2, 15)
end)


local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "MidnightBentoFixed"
ScreenGui.ResetOnSpawn = false
if pcall(function() return CoreGui end) then ScreenGui.Parent = CoreGui else ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui") end

local Wrapper = Instance.new("Frame")
Wrapper.Name = "Wrapper"
Wrapper.Size = CFG.MainSize
Wrapper.Position = UDim2.new(0.5, -250, 0.5, -150)
Wrapper.BackgroundColor3 = CFG.MainColor
Wrapper.BorderSizePixel = 0
Wrapper.ClipsDescendants = true
Wrapper.Parent = ScreenGui

local WrapperCorner = Instance.new("UICorner") WrapperCorner.CornerRadius = UDim.new(0, 16) WrapperCorner.Parent = Wrapper
local WrapperStroke = Instance.new("UIStroke") WrapperStroke.Color = CFG.BorderColor WrapperStroke.Thickness = 1 WrapperStroke.Parent = Wrapper


local dragging, dragInput, dragStart, startPos
local function update(input)
    local delta = input.Position - dragStart
    TweenService:Create(Wrapper, TweenInfo.new(0.05), {Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)}):Play()
end
Wrapper.InputBegan:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then dragging = true dragStart = input.Position startPos = Wrapper.Position input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end) end end)
Wrapper.InputChanged:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end end)
UserInputService.InputChanged:Connect(function(input) if input == dragInput and dragging then update(input) end end)


local Sidebar = Instance.new("Frame") Sidebar.Size = UDim2.new(0, 50, 1, 0) Sidebar.BackgroundColor3 = Color3.fromRGB(8, 8, 8) Sidebar.BorderSizePixel = 0 Sidebar.Parent = Wrapper
local SidebarLayout = Instance.new("UIListLayout") SidebarLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center SidebarLayout.Padding = UDim.new(0, 10) SidebarLayout.Parent = Sidebar
local SidebarPad = Instance.new("UIPadding") SidebarPad.PaddingTop = UDim.new(0, 15) SidebarPad.Parent = Sidebar

local function SwitchTab(tabName, btnContainer, btnIcon)
    for name, page in pairs(Library.Pages) do page.Visible = false end
    Library.Pages[tabName].Visible = true
    for _, child in pairs(Sidebar:GetChildren()) do
        if child:IsA("Frame") and child:FindFirstChild("UIStroke") then
            child.BackgroundColor3 = Color3.fromRGB(5,5,5)
            child.UIStroke.Color = Color3.fromRGB(20,20,20)
            if child:FindFirstChild("ImageButton") then child.ImageButton.ImageColor3 = CFG.TextSub end
        end
    end
    if btnContainer and btnIcon then
        btnContainer.BackgroundColor3 = Color3.fromRGB(22,22,22)
        btnContainer.UIStroke.Color = Color3.fromRGB(45,45,45)
        btnIcon.ImageColor3 = CFG.Accent
    end
end

local function CreateTabBtn(tabName, iconId, isDefault)
    local Container = Instance.new("Frame") Container.Size = UDim2.new(0, 36, 0, 36) Container.BackgroundColor3 = isDefault and Color3.fromRGB(22,22,22) or Color3.fromRGB(5,5,5) Container.Parent = Sidebar
    local C = Instance.new("UICorner") C.CornerRadius = UDim.new(0,10) C.Parent = Container
    local S = Instance.new("UIStroke") S.Color = isDefault and Color3.fromRGB(45,45,45) or Color3.fromRGB(20,20,20) S.Parent = Container
    local Btn = Instance.new("ImageButton") Btn.Size = UDim2.new(0, 24, 0, 24) Btn.Position = UDim2.new(0.5, -12, 0.5, -12) Btn.BackgroundTransparency = 1 Btn.Image = iconId Btn.ImageColor3 = isDefault and CFG.Accent or CFG.TextSub Btn.BorderSizePixel = 0 Btn.Parent = Container
    Btn.MouseButton1Click:Connect(function() SwitchTab(tabName, Container, Btn) end)
end


local Content = Instance.new("Frame") Content.Size = UDim2.new(1, -65, 1, -20) Content.Position = UDim2.new(0, 60, 0, 10) Content.BackgroundTransparency = 1 Content.Parent = Wrapper


local function CreateCustomBox(parent, name, size, position)
    local Box = Instance.new("Frame") Box.Name = name Box.Size = size Box.Position = position Box.BackgroundColor3 = CFG.CardColor Box.BorderSizePixel = 0 Box.Parent = parent
    local C = Instance.new("UICorner") C.CornerRadius = UDim.new(0, 10) C.Parent = Box
    local S = Instance.new("UIStroke") S.Color = CFG.BorderColor S.Parent = Box
    local P = Instance.new("UIPadding") P.PaddingTop = UDim.new(0,10) P.PaddingLeft = UDim.new(0,12) P.PaddingRight = UDim.new(0,12) P.PaddingBottom = UDim.new(0,10) P.Parent = Box
    Box.MouseEnter:Connect(function() TweenService:Create(S, TweenInfo.new(0.3), {Color = CFG.HoverColor}):Play() end)
    Box.MouseLeave:Connect(function() TweenService:Create(S, TweenInfo.new(0.3), {Color = CFG.BorderColor}):Play() end)
    return Box
end
local function CreateHeader(parent, text)
    local Title = Instance.new("TextLabel") Title.Text = string.upper(text) Title.Font = CFG.FontBold Title.TextSize = 10 Title.TextColor3 = CFG.TextSub Title.Size = UDim2.new(1, 0, 0, 15) Title.BackgroundTransparency = 1 Title.TextXAlignment = Enum.TextXAlignment.Left Title.Parent = parent
end
local function AddToggle(parent, flag, text, default, callback)
    Library.Flags[flag] = default or false
    local Container = Instance.new("TextButton") Container.Size = UDim2.new(1, 0, 0, 24) Container.BackgroundTransparency = 1 Container.Text = "" Container.Parent = parent
    local Label = Instance.new("TextLabel") Label.Text = text Label.Size = UDim2.new(0.7, 0, 1, 0) Label.BackgroundTransparency = 1 Label.TextColor3 = CFG.TextMain Label.TextSize = 11 Label.Font = CFG.Font Label.TextXAlignment = Enum.TextXAlignment.Left Label.Parent = Container
    local Switch = Instance.new("Frame") Switch.Size = UDim2.new(0, 28, 0, 14) Switch.AnchorPoint = Vector2.new(1, 0.5) Switch.Position = UDim2.new(1, 0, 0.5, 0) Switch.BackgroundColor3 = Library.Flags[flag] and CFG.Accent or Color3.fromRGB(30,30,30) Switch.BorderSizePixel = 0 Switch.Parent = Container
    local SC = Instance.new("UICorner") SC.CornerRadius = UDim.new(1,0) SC.Parent = Switch
    local Dot = Instance.new("Frame") Dot.Size = UDim2.new(0, 10, 0, 10) Dot.BackgroundColor3 = Color3.fromRGB(255,255,255) Dot.Position = Library.Flags[flag] and UDim2.new(1, -12, 0.5, -5) or UDim2.new(0, 2, 0.5, -5) Dot.BorderSizePixel = 0 Dot.Parent = Switch
    local DC = Instance.new("UICorner") DC.CornerRadius = UDim.new(1,0) DC.Parent = Dot
    Container.MouseButton1Click:Connect(function() Library.Flags[flag] = not Library.Flags[flag] local state = Library.Flags[flag] TweenService:Create(Switch, TweenInfo.new(0.2), {BackgroundColor3 = state and CFG.Accent or Color3.fromRGB(30,30,30)}):Play() TweenService:Create(Dot, TweenInfo.new(0.2), {Position = state and UDim2.new(1, -12, 0.5, -5) or UDim2.new(0, 2, 0.5, -5)}):Play() if callback then callback(state) end end)
end
local function AddDropdown(parent, flag, text, options, default, callback)
    Library.Flags[flag] = default or options[1]
    local Container = Instance.new("Frame") Container.Size = UDim2.new(1, 0, 0, 35) Container.BackgroundTransparency = 1 Container.ClipsDescendants = true Container.Parent = parent
    local Header = Instance.new("TextButton") Header.Size = UDim2.new(1, 0, 0, 30) Header.BackgroundColor3 = Color3.fromRGB(18, 18, 18) Header.Text = "" Header.AutoButtonColor = false Header.BorderSizePixel = 0 Header.Parent = Container
    local HC = Instance.new("UICorner") HC.CornerRadius = UDim.new(0,6) HC.Parent = Header
    local Label = Instance.new("TextLabel") Label.Text = text Label.Position = UDim2.new(0, 10, 0, 0) Label.Size = UDim2.new(0.5, -10, 1, 0) Label.BackgroundTransparency = 1 Label.TextColor3 = CFG.TextSub Label.TextSize = 10 Label.Font = CFG.Font Label.TextXAlignment = Enum.TextXAlignment.Left Label.Parent = Header
    local Value = Instance.new("TextLabel") Value.Text = tostring(Library.Flags[flag]) Value.Position = UDim2.new(0.5, 0, 0, 0) Value.Size = UDim2.new(0.5, -25, 1, 0) Value.BackgroundTransparency = 1 Value.TextColor3 = CFG.TextMain Value.TextSize = 10 Value.Font = CFG.FontBold Value.TextXAlignment = Enum.TextXAlignment.Right Value.Parent = Header
    local ListFrame = Instance.new("Frame") ListFrame.Size = UDim2.new(1, 0, 0, #options * 25) ListFrame.Position = UDim2.new(0, 0, 0, 35) ListFrame.BackgroundTransparency = 1 ListFrame.Parent = Container
    local ListLayout = Instance.new("UIListLayout") ListLayout.SortOrder = Enum.SortOrder.LayoutOrder ListLayout.Parent = ListFrame
    local isOpen = false
    Header.MouseButton1Click:Connect(function() isOpen = not isOpen TweenService:Create(Container, TweenInfo.new(0.3), {Size = UDim2.new(1, 0, 0, isOpen and (35 + (#options*25) + 5) or 35)}):Play() end)
    for _, opt in ipairs(options) do
        local OptBtn = Instance.new("TextButton") OptBtn.Size = UDim2.new(1, 0, 0, 25) OptBtn.BackgroundColor3 = Color3.fromRGB(15,15,15) OptBtn.BorderSizePixel = 0 OptBtn.Text = "  "..opt OptBtn.TextColor3 = CFG.TextSub OptBtn.TextSize = 10 OptBtn.Font = CFG.Font OptBtn.TextXAlignment = Enum.TextXAlignment.Left OptBtn.Parent = ListFrame
        OptBtn.MouseButton1Click:Connect(function() Library.Flags[flag] = opt Value.Text = opt if callback then callback(opt) end isOpen = false TweenService:Create(Container, TweenInfo.new(0.3), {Size = UDim2.new(1, 0, 0, 35)}):Play() end)
    end
end
local function AddSlider(parent, flag, text, min, max, default, callback)
    Library.Flags[flag] = default or min
    local Container = Instance.new("Frame") Container.Size = UDim2.new(1, 0, 0, 40) Container.BackgroundTransparency = 1 Container.Parent = parent
    local Title = Instance.new("TextLabel") Title.Text = text Title.Size = UDim2.new(1, 0, 0, 20) Title.BackgroundTransparency = 1 Title.TextColor3 = CFG.TextMain Title.TextSize = 10 Title.Font = CFG.Font Title.TextXAlignment = Enum.TextXAlignment.Left Title.Parent = Container
    local Value = Instance.new("TextLabel") Value.Text = tostring(Library.Flags[flag]) Value.Size = UDim2.new(1, 0, 0, 20) Value.BackgroundTransparency = 1 Value.TextColor3 = CFG.TextSub Value.TextSize = 10 Value.Font = CFG.FontBold Value.TextXAlignment = Enum.TextXAlignment.Right Value.Parent = Container
    local SliderBg = Instance.new("TextButton") SliderBg.Text = "" SliderBg.Size = UDim2.new(1, 0, 0, 4) SliderBg.Position = UDim2.new(0, 0, 0, 25) SliderBg.BackgroundColor3 = Color3.fromRGB(30, 30, 30) SliderBg.BorderSizePixel = 0 SliderBg.AutoButtonColor = false SliderBg.Parent = Container
    local Fill = Instance.new("Frame") local startP = (Library.Flags[flag]-min)/(max-min) Fill.Size = UDim2.new(startP, 0, 1, 0) Fill.BackgroundColor3 = CFG.Accent Fill.BorderSizePixel = 0 Fill.Parent = SliderBg
    local sliding = false
    local function UpdateVal(input)
        local sizeX = SliderBg.AbsoluteSize.X local mouseX = math.clamp(input.Position.X - SliderBg.AbsolutePosition.X, 0, sizeX) local percent = mouseX / sizeX
        local newVal = math.floor(min + ((max - min) * percent) * 100) / 100 Library.Flags[flag] = newVal Value.Text = tostring(newVal) TweenService:Create(Fill, TweenInfo.new(0.1), {Size = UDim2.new(percent, 0, 1, 0)}):Play() if callback then callback(newVal) end
    end
    SliderBg.InputBegan:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then sliding = true UpdateVal(i) end end)
    UserInputService.InputChanged:Connect(function(i) if sliding and (i.UserInputType == Enum.UserInputType.MouseMovement or i.UserInputType == Enum.UserInputType.Touch) then UpdateVal(i) end end)
    UserInputService.InputEnded:Connect(function(i) if i.UserInputType == Enum.UserInputType.MouseButton1 or i.UserInputType == Enum.UserInputType.Touch then sliding = false end end)
end


local PageCombat = Instance.new("Frame") PageCombat.Name = "CombatPage" PageCombat.Size = UDim2.new(1, 0, 1, 0) PageCombat.BackgroundTransparency = 1 PageCombat.Parent = Content Library.Pages["Combat"] = PageCombat
local PageESP = Instance.new("Frame") PageESP.Name = "ESPPage" PageESP.Size = UDim2.new(1, 0, 1, 0) PageESP.BackgroundTransparency = 1 PageESP.Visible = false PageESP.Parent = Content Library.Pages["ESP"] = PageESP

CreateTabBtn("Combat", "rbxassetid://18306918089", true)
CreateTabBtn("ESP", "rbxassetid://6523858394", false) 


local Box1 = CreateCustomBox(PageCombat, "Combat", UDim2.new(0, 300, 0, 280), UDim2.new(0, 0, 0, 0)) CreateHeader(Box1, "Combat")
local List1 = Instance.new("UIListLayout") List1.Parent = Box1 List1.SortOrder = Enum.SortOrder.LayoutOrder List1.Padding = UDim.new(0, 5)
local Sp1 = Instance.new("Frame") Sp1.Size = UDim2.new(1,0,0,15) Sp1.BackgroundTransparency = 1 Sp1.Parent = Box1
AddToggle(Box1, "Aimbot", "Enable Aimbot", false, function(v) AimSettings.Enabled = v end)
AddDropdown(Box1, "Part", "Target", {"Head", "Torso", "HumanoidRootPart"}, "Head", function(v) AimSettings.TargetPart = v end)
AddToggle(Box1, "Alive", "Alive Check", true, function(v) AimSettings.AliveCheck = v end)
AddToggle(Box1, "Team", "Team Check", false, function(v) AimSettings.TeamCheck = v end)
AddToggle(Box1, "Wall", "Wall Check", false, function(v) AimSettings.WallCheck = v end)
AddSlider(Box1, "FOV", "FOV Size", 0, 360, 90, function(v) AimSettings.FOV = v end)

local Box2 = CreateCustomBox(PageCombat, "Settings", UDim2.new(1, -305, 0, 280), UDim2.new(0, 305, 0, 0)) CreateHeader(Box2, "Settings")
local List2 = Instance.new("UIListLayout") List2.Parent = Box2 List2.SortOrder = Enum.SortOrder.LayoutOrder List2.Padding = UDim.new(0, 5)
local Sp2 = Instance.new("Frame") Sp2.Size = UDim2.new(1,0,0,15) Sp2.BackgroundTransparency = 1 Sp2.Parent = Box2
AddToggle(Box2, "ShowFOV", "Show FOV", true, function(v) AimSettings.ShowFOV = v end)
AddSlider(Box2, "Smooth", "Smoothness", 0, 10, 5, function(v) AimSettings.Smoothness = 0.01 + (v/20) end)


local Box3 = CreateCustomBox(PageESP, "ESPMain", UDim2.new(0, 300, 0, 280), UDim2.new(0, 0, 0, 0)) CreateHeader(Box3, "Visuals")
local List3 = Instance.new("UIListLayout") List3.Parent = Box3 List3.SortOrder = Enum.SortOrder.LayoutOrder List3.Padding = UDim.new(0, 5)
local Sp3 = Instance.new("Frame") Sp3.Size = UDim2.new(1,0,0,15) Sp3.BackgroundTransparency = 1 Sp3.Parent = Box3
AddToggle(Box3, "ESPBox", "Esp Box", false, function(v) ESPSettings.Box = v end)
AddToggle(Box3, "ESPLine", "Esp Line", false, function(v) ESPSettings.Line = v end)
AddToggle(Box3, "ESPName", "Esp Name", false, function(v) ESPSettings.Name = v end)
AddToggle(Box3, "ESPHealth", "Esp Health", false, function(v) ESPSettings.Health = v end)
AddToggle(Box3, "ESPSkeleton", "Esp Skeleton", false, function(v) ESPSettings.Skeleton = v end)
AddToggle(Box3, "ESPCount", "Enemy Count", false, function(v) ESPSettings.Count = v end)

local Box4 = CreateCustomBox(PageESP, "ESPSettings", UDim2.new(1, -305, 0, 280), UDim2.new(0, 305, 0, 0)) CreateHeader(Box4, "ESP Settings")
local List4 = Instance.new("UIListLayout") List4.Parent = Box4 List4.SortOrder = Enum.SortOrder.LayoutOrder List4.Padding = UDim.new(0, 5)
local Sp4 = Instance.new("Frame") Sp4.Size = UDim2.new(1,0,0,15) Sp4.BackgroundTransparency = 1 Sp4.Parent = Box4
AddToggle(Box4, "ESPAlive", "Alive Check", true, function(v) ESPSettings.AliveCheck = v end)
AddToggle(Box4, "ESPTeam", "Team Check", false, function(v) ESPSettings.TeamCheck = v end)
AddToggle(Box4, "ESPWall", "Wall Check", false, function(v) ESPSettings.WallCheck = v end)

print("Midnight Bento Loaded: Health Bar Fixed & Full Features")